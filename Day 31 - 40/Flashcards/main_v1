import os, random
import tkinter as tk
import pandas as pd 

BACKGROUND_COLOR = "#B1DDC6"
flip_timer = None
rand_var = None

os.system("clear")
base_dir = os.path.dirname(os.path.abspath(__file__))

data = os.path.join(base_dir, "data", "french_words.csv")
image_card_back = os.path.join(base_dir, "images", "card_back.png")
image_card_front = os.path.join(base_dir, "images", "card_front.png")
image_right = os.path.join(base_dir, "images", "right.png")
image_wrong = os.path.join(base_dir, "images", "wrong.png")

#-----------Main Window------------#
root = tk.Tk()
root.title("French Words Memory Cards")
root.config(padx=10, pady=10, bg=BACKGROUND_COLOR)

#-----------Creating the canvas-------------#
canvas = tk.Canvas(root, height=526, width=800, bg=BACKGROUND_COLOR)

#Loading the images
card_front = tk.PhotoImage(file=image_card_front)
card_back = tk.PhotoImage(file=image_card_back)
right = tk.PhotoImage(file=image_right)
wrong = tk.PhotoImage(file=image_wrong)

#Placing the canvas using the grid method
canvas.grid(column=0, row=0, columnspan=2, padx=10, pady=10)
card_image = canvas.create_image(410, 270, image=card_front)
card_word = canvas.create_text(400, 100, text="", font=("Times New Roman", 42, "italic"))
french_word = canvas.create_text(400, 220, text="", font=("Times New Roman", 72, "italic"))


#--Loading words-list into a local variable--#
with open(data, "r") as file:
    df = pd.read_csv(file)

def display_eng_word():
    global flip_timer
    canvas.itemconfig(card_image, image=card_back)
    canvas.itemconfig(card_word, text="English")
    canvas.itemconfig(french_word, text= f"{df.iloc[rand_var]['English']}")
    if flip_timer != None:
        canvas.after_cancel(flip_timer)

def display_french_word():
    length = len(df)
    global rand_var, flip_timer

    if flip_timer is not None:
        canvas.after_cancel(flip_timer)

    rand_var = random.randrange(length)
    canvas.itemconfig(card_image, image=card_front)
    canvas.itemconfig(card_word, text="French")
    canvas.itemconfig(french_word, text= f"{df.iloc[rand_var]['French']}")
    flip_timer = canvas.after(3000, display_eng_word)

def known_word():
    global df, flip_timer
    df = df.drop(rand_var).reset_index(drop=True)
    if flip_timer != None:
        canvas.after_cancel(flip_timer)
    display_french_word()

right_button = tk.Button(root, image=right, command=known_word)
wrong_button = tk.Button(root, image=wrong, command=display_french_word)
right_button.grid(column=1, row=1)
wrong_button.grid(column=0, row=1)

display_french_word()

root.mainloop()